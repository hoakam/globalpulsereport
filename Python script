import xml.etree.ElementTree as ET
import frontmatter
from datetime import datetime

# Parse Blogger export
tree = ET.parse('blogger-export.xml')
root = tree.getroot()

# Namespace handling
ns = {'atom': 'http://www.w3.org/2005/Atom'}

for entry in root.findall('.//atom:entry', ns):
    if 'post' in entry.find('atom:category', ns).get('term'):
        # Extract post data
        title = entry.find('atom:title', ns).text
        content = entry.find('atom:content', ns).text
        published = entry.find('atom:published', ns).text
        
        # Convert date format
        date_obj = datetime.strptime(published, '%Y-%m-%dT%H:%M:%S.%fZ')
        filename_date = date_obj.strftime('%Y-%m-%d')
        slug = title.lower().replace(' ', '-')[:50]
        
        # Create front matter
        post = frontmatter.Post(content)
        post['title'] = title
        post['date'] = date_obj.strftime('%Y-%m-%d %H:%M:%S %z')
        
        # Save as markdown
        with open(f'_posts/{filename_date}-{slug}.md', 'w') as f:
            f.write(frontmatter.dumps(post))
